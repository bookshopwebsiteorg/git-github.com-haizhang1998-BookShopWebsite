<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.bookShop.mapper.GoodsMapper">
<!--    private String goodsName; //商品名称-->
<!--    private String imgDir; //图片地址-->
<!--    private double price;  //商品价格-->
<!--    private String detail; //商品信息-->
<!--    private int goodsId;  //商品的id-->
<!--    private String addr;  //商品的发货地址-->
<!--    private int possesserId; //拥有该商品的id-->
<!--    private int remainNumber; //库存-->
<!--    private String type;  //书籍种类-->
<!--    private Date upTime;-->

    <resultMap id="goodsInfoMap" type="GoodsInfo">
      <id property="goodsId" column="goodsId"></id>
        <result property="goodsName" column="goodsName"></result>
        <result property="imgDir" column="imgDir"></result>
        <result property="price" column="price"></result>
        <result property="detail" column="detail"></result>
        <result property="addr" column="addr"></result>
        <result property="possesserId" column="possesserId"></result>
        <result property="remainNumber" column="remainNumber"></result>
        <result property="type" column="type"></result>
        <result property="upTime" column="upTime"></result>
    </resultMap>

    <sql id="queryGoodsSql">
        <where>
            <if test="goodsId > 0">
              goodsId=#{goodsId}
            </if>
            <if test="goodsName!=null and goodsName.trim()!=null">
              or goodsName=#{goodsName}
            </if>
        </where>
    </sql>

    <sql id="bindSql">
        <if test="addr!=null and addr.trim!=null">
            <bind name="_addr" value="'%'+addr+'%'"/>
        </if>
        <if test="goodsName!=null and goodsName.trim()!=null">
            <bind name="_goodsName" value="'%'+goodsName+'%'"/>
        </if>
        <if test="type!=null and type.trim()!=null">
            <bind name="_type" value="'%'+type+'%'"/>
        </if>

    </sql>

<!--     根据类型或者地址或者持有者或者上传时间可以查询货物列表-->
     <sql id="queryGoodsInVagueSql">
         <trim prefix="where" prefixOverrides="or" suffixOverrides="or">
             <if test="addr!=null and addr.trim()!=null">
                 addr like #{_addr}
             </if>
             <if test="goodsName!=null and goodsName.trim()!=null">
                 or  goodsName like #{_goodsName}
             </if>
             <if test="type!=null and type.trim()!=null">
                 or type like '%${type}%'
             </if>

         </trim>
     </sql>
<!--    //获取所有货物信息，HashMap，键值对===  货物编号====货物信息-->
<!--    public HashMap<Integer, GoodsInfo> getAllGoods();-->
        <select id="getAllGoods" resultMap="goodsInfoMap">
            select * from goods
        </select>

<!--    //根据指定的Id号或货物姓名得到指定货物的全部信息-->
<!--    public GoodsInfo queryGoodsByGoodsInfo(GoodsInfo goodsInfo);-->
        <select id="queryGoodsByGoodsInfo" resultMap="goodsInfoMap">
            select * from goods
            <include refid="queryGoodsSql"></include>
        </select>


<!--    //得到所有新上架的商品-->
<!--    public List<GoodsInfo> getAllNewGood();-->
        <select id="getAllNewGood" resultMap="goodsInfoMap">
           select * from (select * from goods ORDER BY upTime DESC)as a where 1=1 LIMIT 10
        </select>


<!--    //实现商品名、商品类型、地址的模糊查询-->
<!--    public List<GoodsInfo>  queryGoodsInVague(String goodsName, String type);-->
        <select id="queryGoodsInVague" resultMap="goodsInfoMap">
           <include refid="bindSql"></include>
           select * from goods
           <include refid="queryGoodsInVagueSql">
           </include>
        </select>
<!--    //得到商铺所有商品-->
<!--    public List<GoodsInfo> queryShopGoods(int merchantId);-->
        <select id="queryShopGoods" resultMap="goodsInfoMap">
            select * from goods
            where possesserId=#{merchantId}
        </select>
</mapper>